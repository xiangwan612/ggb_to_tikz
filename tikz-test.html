<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>TikZ ç”Ÿæˆå™¨æµ‹è¯•</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { color: #58a6ff; margin-bottom: 20px; }
        h2 { color: #7ee787; margin: 20px 0 10px; font-size: 16px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 1000px) { .grid { grid-template-columns: 1fr; } }
        
        textarea {
            width: 100%;
            height: 300px;
            background: #161b22;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 10px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            resize: vertical;
        }
        
        button {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
            font-size: 14px;
        }
        button:hover { background: #2ea043; }
        button.secondary { background: #1f6feb; }
        
        .output {
            background: #161b22;
            border: 1px solid #30363d;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow: auto;
        }
        
        .info-box {
            background: #21262d;
            border-left: 3px solid #58a6ff;
            padding: 12px;
            margin: 10px 0;
            font-size: 13px;
        }
        .warning-box {
            background: #21262d;
            border-left: 3px solid #f85149;
            padding: 12px;
            margin: 10px 0;
            font-size: 13px;
        }
        
        .tab-buttons { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-btn { background: #30363d; }
        .tab-btn.active { background: #238636; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .option { display: flex; align-items: center; gap: 5px; }
        .option input[type="checkbox"] { transform: scale(1.2); }
        .option input[type="number"] { width: 60px; }
        .option label { font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ TikZ ç”Ÿæˆå™¨æµ‹è¯•</h1>
        
        <div class="info-box">
            <strong>ä¸¤ç§ç”Ÿæˆæ¨¡å¼ï¼š</strong><br>
            1. <strong>æœ¬åœ°æ¨¡æ¿ç”Ÿæˆ</strong> - çº¯ JS ç”Ÿæˆï¼Œé€Ÿåº¦å¿«ï¼Œé€‚åˆæ ‡å‡†å›¾å½¢<br>
            2. <strong>AI å¢å¼ºæ¨¡å¼</strong> - ç”¨ AI ä¼˜åŒ–ä»£ç è´¨é‡ï¼Œæ”¯æŒæ›´å¤æ‚çš„å›¾å½¢å’Œç¾åŒ–
        </div>
        
        <div class="grid">
            <div>
                <h2>è¾“å…¥ GGB XML</h2>
                <textarea id="xmlInput" placeholder="ç²˜è´´ GGB XML..."></textarea>
                <button onclick="generateLocal()">ç”Ÿæˆæœ¬åœ° TikZ</button>
                <button class="secondary" onclick="generateAI()">AI ä¼˜åŒ–ç”Ÿæˆ</button>
                <button onclick="loadSample()">åŠ è½½ç¤ºä¾‹</button>
                
                <h2>ç”Ÿæˆé€‰é¡¹</h2>
                <div class="options">
                    <div class="option">
                        <input type="checkbox" id="optAxis" checked>
                        <label for="optAxis">åæ ‡è½´</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="optGrid" checked>
                        <label for="optGrid">ç½‘æ ¼</label>
                    </div>
                    <div class="option">
                        <label>XèŒƒå›´:</label>
                        <input type="number" id="optXmin" value="-10" step="1">
                        <input type="number" id="optXmax" value="10" step="1">
                    </div>
                    <div class="option">
                        <label>YèŒƒå›´:</label>
                        <input type="number" id="optYmin" value="-10" step="1">
                        <input type="number" id="optYmax" value="10" step="1">
                    </div>
                </div>
            </div>
            
            <div>
                <h2>è¾“å‡º TikZ ä»£ç </h2>
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="showTab('local')">æœ¬åœ°ç”Ÿæˆ</button>
                    <button class="tab-btn" onclick="showTab('ai')">AI ç”Ÿæˆ</button>
                </div>
                <div id="tab-local" class="tab-content active">
                    <textarea id="localOutput" readonly placeholder="æœ¬åœ°ç”Ÿæˆçš„ TikZ ä»£ç ..."></textarea>
                </div>
                <div id="tab-ai" class="tab-content">
                    <textarea id="aiOutput" readonly placeholder="AI ä¼˜åŒ–çš„ TikZ ä»£ç ..."></textarea>
                </div>
            </div>
        </div>
        
        <h2>ä½¿ç”¨æ–¹æ³•</h2>
        <div class="info-box">
            <strong>æœ¬åœ°æ¨¡æ¿ç”Ÿæˆé€‚åˆï¼š</strong>
            <ul style="margin-left: 20px; margin-top: 5px;">
                <li>æ ‡å‡†å‡½æ•°ï¼ˆf(x) = xÂ², sin(x), 1/x ç­‰ï¼‰</li>
                <li>å·²çŸ¥ç„¦ç‚¹å’Œå‚æ•°çš„åœ†é”¥æ›²çº¿</li>
                <li>ç®€å•ç‚¹ã€çº¿æ®µã€ç›´çº¿</li>
                <li>éœ€è¦ç¦»çº¿ä½¿ç”¨æˆ–å¿«é€Ÿé¢„è§ˆ</li>
            </ul>
        </div>
        <div class="warning-box">
            <strong>éœ€è¦ AI å¢å¼ºçš„æƒ…å†µï¼š</strong>
            <ul style="margin-left: 20px; margin-top: 5px;">
                <li>å¤æ‚å‡ ä½•å…³ç³»ï¼ˆå¦‚å¤šåœ†ç›¸åˆ‡ã€å¤æ‚äº¤ç‚¹ï¼‰</li>
                <li>éœ€è¦ç¾è§‚çš„æ ‡æ³¨å’Œæ ·å¼</li>
                <li>éæ ‡å‡†åæ ‡ç³»æˆ–å˜æ¢</li>
                <li>åŠ¨ç”»æˆ–å¤šå¸§å›¾å½¢</li>
            </ul>
        </div>
    </div>

    <script src="ggb-parser.js"></script>
    <script src="tikz-generator.js"></script>
    <script>
        const sampleXML = `<?xml version="1.0" encoding="utf-8"?>
<geogebra format="5.0">
<construction>
<command name="Ellipse">
	<input a0="(3, 0)" a1="(-3, 0)" a2="10"/>
	<output a0="E"/>
</command>
<element type="conic" label="E">
	<show object="true" label="false"/>
	<objColor r="110" g="109" b="115"/>
	<lineStyle thickness="5"/>
</element>
<command name="Parabola">
	<input a0="(2, 0)" a1="x = -2"/>
	<output a0="P"/>
</command>
<element type="conic" label="P">
	<show object="true" label="false"/>
	<objColor r="0" g="103" b="88"/>
	<lineStyle thickness="5"/>
</element>
<expression label="f" exp="f(x) = x^2" type="function"/>
<element type="function" label="f">
	<show object="true" label="false"/>
	<objColor r="21" g="101" b="192"/>
</element>
<element type="point" label="A">
	<show object="true" label="true"/>
	<objColor r="211" g="47" b="47"/>
	<coords x="-6.75" y="3.07" z="1"/>
</element>
<element type="point" label="B">
	<show object="true" label="true"/>
	<objColor r="211" g="47" b="47"/>
	<coords x="-2" y="-2" z="1"/>
</element>
<command name="Segment">
	<input a0="A" a1="B"/>
	<output a0="s"/>
</command>
<element type="segment" label="s">
	<show object="true" label="false"/>
	<objColor r="199" g="80" b="0"/>
	<lineStyle thickness="3"/>
</element>
</construction>
</geogebra>`;

        function loadSample() {
            document.getElementById('xmlInput').value = sampleXML;
        }

        function getOptions() {
            return {
                strictStatic: true,
                semanticFirst: false,
                useSourceStyle: false,
                defaultStrokeColor: 'black',
                defaultStrokeThickness: 'thick',
                defaultPointColor: 'black',
                lineExtensionStart: 0.25,
                lineExtensionEnd: 0.25,
                axis: document.getElementById('optAxis').checked,
                grid: document.getElementById('optGrid').checked,
                xmin: parseFloat(document.getElementById('optXmin').value),
                xmax: parseFloat(document.getElementById('optXmax').value),
                ymin: parseFloat(document.getElementById('optYmin').value),
                ymax: parseFloat(document.getElementById('optYmax').value)
            };
        }

        function generateLocal() {
            const xml = document.getElementById('xmlInput').value.trim();
            if (!xml) {
                alert('è¯·è¾“å…¥ XML');
                return;
            }
            
            try {
                // è§£æ
                const parser = new GGBParser(xml);
                const data = parser.parse();
                
                // ç”Ÿæˆ TikZ
                const generator = new TikZGenerator(getOptions());
                const tikz = generator.generate(data);
                
                document.getElementById('localOutput').value = tikz;
                showTab('local');
                
            } catch (err) {
                document.getElementById('localOutput').value = 'é”™è¯¯: ' + err.message + '\n' + err.stack;
            }
        }

        function generateAI() {
            const xml = document.getElementById('xmlInput').value.trim();
            if (!xml) {
                alert('è¯·è¾“å…¥ XML');
                return;
            }
            
            // è§£æè·å–ç»“æ„åŒ–æ•°æ®
            const parser = new GGBParser(xml);
            const data = parser.parse();
            
            // ç”Ÿæˆ AI Prompt
            const prompt = generateAIPrompt(data);
            
            document.getElementById('aiOutput').value = 
`== AI Prompt å·²ç”Ÿæˆ ==
è¯·å¤åˆ¶ä»¥ä¸‹å†…å®¹å‘é€ç»™ AIï¼ˆå¦‚ GPT/Claudeï¼‰æ¥ç”Ÿæˆä¼˜åŒ–åçš„ TikZ ä»£ç ï¼š

${prompt}

== æˆ–è€…ä½¿ç”¨ä»¥ä¸‹ç»“æ„åŒ–æ•°æ® ==
\`\`\`json
${JSON.stringify(data.structured, null, 2)}
\`\`\``;
            showTab('ai');
        }

        function generateAIPrompt(data) {
            const s = data.structured;
            
            let prompt = `è¯·å°†ä»¥ä¸‹ GeoGebra å›¾å½¢è½¬æ¢ä¸ºé«˜è´¨é‡çš„ LaTeX/TikZ ä»£ç ã€‚

## å›¾å½¢å…ƒç´ ç»Ÿè®¡
- ç‚¹: ${s.points?.length || 0} ä¸ª
- å‡½æ•°: ${s.functions?.length || 0} ä¸ª
- çº¿æ®µ: ${s.segments?.length || 0} ä¸ª
- ç›´çº¿: ${s.lines?.length || 0} ä¸ª
- åœ†é”¥æ›²çº¿: ${s.conics?.length || 0} ä¸ª

## è¯¦ç»†æ•°æ®\n`;

            // å‡½æ•°
            if (s.functions?.length > 0) {
                prompt += '\n### å‡½æ•°\n';
                s.functions.forEach(f => {
                    prompt += `- ${f.label}: ${f.exp}, é¢œè‰² ${f.color || 'é»˜è®¤'}\n`;
                });
            }
            
            // åœ†é”¥æ›²çº¿
            if (s.conics?.length > 0) {
                prompt += '\n### åœ†é”¥æ›²çº¿\n';
                s.conics.forEach(c => {
                    prompt += `- ${c.label} (${c.conicType}): `;
                    if (c.focus1Coord) prompt += `ç„¦ç‚¹1(${c.focus1Coord.x},${c.focus1Coord.y}) `;
                    if (c.focus2Coord) prompt += `ç„¦ç‚¹2(${c.focus2Coord.x},${c.focus2Coord.y}) `;
                    if (c.majorAxisLength) prompt += `é•¿è½´${c.majorAxisLength} `;
                    if (c.directrix) prompt += `å‡†çº¿${c.directrix} `;
                    prompt += `\n`;
                });
            }
            
            // ç‚¹
            if (s.points?.length > 0) {
                prompt += '\n### ç‚¹\n';
                s.points.forEach(p => {
                    prompt += `- ${p.label}: (${p.x.toFixed(2)}, ${p.y.toFixed(2)})\n`;
                });
            }
            
            // çº¿æ®µ
            if (s.segments?.length > 0) {
                prompt += '\n### çº¿æ®µ\n';
                s.segments.forEach(seg => {
                    if (seg.startCoord && seg.endCoord) {
                        prompt += `- ${seg.label}: (${seg.startCoord.x.toFixed(2)},${seg.startCoord.y.toFixed(2)}) åˆ° (${seg.endCoord.x.toFixed(2)},${seg.endCoord.y.toFixed(2)})\n`;
                    } else {
                        prompt += `- ${seg.label}: ${seg.startLabel || '?'} åˆ° ${seg.endLabel || '?'}\n`;
                    }
                });
            }
            
            prompt += `
## è¦æ±‚
1. ä½¿ç”¨ pgfplots åº“ï¼Œæ”¯æŒåæ ‡è½´å’Œç½‘æ ¼
2. ä¿æŒåŸå§‹é¢œè‰²å’Œçº¿å®½
3. æ·»åŠ é€‚å½“çš„æ ‡ç­¾
4. ç¡®ä¿æ•°å­¦è¡¨è¾¾å¼æ­£ç¡®è½¬æ¢
5. è¾“å‡ºå®Œæ•´çš„å¯ç¼–è¯‘ LaTeX æ–‡æ¡£

è¯·ç”Ÿæˆ TikZ ä»£ç ï¼š`;

            return prompt;
        }

        function showTab(name) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('tab-' + name).classList.add('active');
        }
    </script>
</body>
</html>
