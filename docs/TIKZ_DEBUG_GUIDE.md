# TikZ 调试器使用指南

本文档对应当前 React 版本页面中的 `TikZ 调试` 功能，目标是帮助你快速完成：
- 从 GeoGebra 画板转译 TikZ
- 在网页内预览/调试
- 用“转译偏好”稳定控制输出风格

---

## 1. 打开方式

1. 先确保右侧原生 GeoGebra 画板已就绪。  
2. 点击画板区域上方按钮：`TikZ 调试`。  
3. 会弹出 TikZ 调试器窗口（可拖动）。

---

## 2. 调试器主界面

调试器顶部常用按钮：
- `编译预览`：用当前左侧代码重新编译右侧预览。
- `AI优化`：预留入口（当前未接入智能改写）。
- `复制代码`：复制左侧当前 TikZ 代码。
- `关闭`：关闭调试器弹窗。

中间为双栏：
- 左栏：`TikZ 代码`（可直接编辑）
- 右栏：`编译预览`（TikZJax）

预览区上方会显示估算尺寸（宽/高，cm）。

---

## 3. 转译偏好（重点）

点击调试器标题右侧 `转译偏好` 打开设置。  
点击 `应用设置` 或 `应用并关闭` 后会立即生效，并刷新调试代码。

### 3.1 缩放与画幅

- `目标宽度（cm）` / `目标高度（cm）`  
  用于自动估算 `scale`。

- `scale 优先`  
  可选：
  - `fit（宽高都尽量满足）`
  - `width（优先宽度）`
  - `height（优先高度）`

- `坐标轴对称优化`  
  - `关闭`：使用当前普通边界策略  
  - `开启`：按对称策略重算坐标轴范围

- `对称优化目标`  
  可选：
  - `整体面积最小优先`
  - `整体面积最大优先`
  - `坐标范围上下对称`
  - `坐标范围左右对称`

- `坐标轴延伸（单位）`  
  图形边界向外扩展量（默认 0.5）。

- `scope 裁剪偏移（单位）`  
  在坐标轴范围基础上再次扩缩 `clip`：  
  - `0`：与坐标轴一致  
  - `>0`：向外扩  
  - `<0`：向内收  

### 3.2 标签与角度

- `标签偏移（pt）`
- `标签字号（pt）`
- `两直线角度区域`：`auto / left / right / above / below`

### 3.3 TikZ 导出样式

- `是否显示坐标轴`
- `scale 缩放`
- `直线/射线延伸参数`
- `点半径（pt）`
- `多边形填充颜色`
- `坐标轴线宽`
- `圆锥曲线线宽`
- `函数线宽`
- `直线/射线线宽`
- `线段线宽`
- `多边形边线线宽`

---

## 4. 函数 domain 与 clip 规则（当前实现）

当前策略是“先定 clip，再修 domain”：

1. 先计算最终坐标轴范围。  
2. 生成 `\clip (...) rectangle (...);`。  
3. 再把函数 `domain` 对齐到 clip 的 x 范围，避免空白区域。

补充：
- 连续函数（如 `sin/cos/exp/多项式`）默认使用整段范围。
- 疑似不连续函数（如 `tan/ln/log/sqrt/asin/acos` 或含 `/`）保守处理，避免错误连线。

---

## 5. 推荐工作流

1. 在画板完成构图。  
2. 打开 `TikZ 调试`。  
3. 在 `转译偏好` 先定好：
   - 坐标轴开关
   - 线宽/点半径
   - 对称优化策略
   - 裁剪偏移
4. 点击 `应用设置`。  
5. 检查右侧预览与尺寸提示。  
6. 如需微调，直接改左侧代码并 `编译预览`。  
7. `复制代码` 到本地 LaTeX 工程。

---

## 6. 常见问题

### Q1：预览为空怎么办？
- 先点一次 `编译预览`。
- 检查是否使用了 TikZJax 暂不支持的宏包命令。
- 若网页预览仍失败，可复制代码到本地 TeX 编译。

### Q2：为什么画面有裁剪？
- 函数、抛物线、双曲线默认会用 `scope + clip` 限定显示区域，这是预期行为。  
- 可通过 `scope 裁剪偏移` 调整宽松程度。

### Q3：角度位置不理想？
- 调整 `两直线角度区域`（`left/right/above/below/auto`）。  
- 点标签可通过 `标签偏移` 和 `标签字号` 调整。

---

## 7. 文件位置

本指南文件位于：

`/Users/lixiangwan/Desktop/ggb_ai/TIKZ_DEBUG_GUIDE.md`

如果你想改成中文名（例如 `TikZ调试使用指南.md`）或移动到 `react-app/` 下，我可以直接帮你迁移并加到 README 索引。
