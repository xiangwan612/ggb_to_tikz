# React 迁移计划（阶段化）

## 阶段 1（已完成）
- 创建 `react-app/` 独立迁移工程（Vite + React）
- 保留旧版 `index.html` 并复制到 `public/legacy-index.html`
- React 页面内嵌旧版 iframe，保证功能不断档

## 阶段 2（进行中，核心已打通）
- 已迁移 API 配置面板（provider/model/key）到 React 状态
- 已抽离请求层：`chat/completions` 与 Doubao `/responses` 双通道（失败自动回退）
- 已支持加载模型（失败回退默认模型）和手动模型 ID 输入
- 已支持发送测试请求并显示模型返回文本
- 待补充：与旧版完全一致的上下文记忆和图片输入

## 阶段 3
- 已迁移聊天区（文本 + 粘贴图片）
- 已接入上下文记忆开关与历史轮数
- 已支持 Enter 发送与输入法组合键保护（IME）
- 验收现状：核心链路可用；命令编辑器与画板执行仍由旧版 iframe 承担

## 阶段 4
- 已迁移命令编辑器与白名单校验（含保留字拦截）
- 已支持 AI 返回自动追加命令、手动编辑、校验、复制、清空
- 已支持“执行到右侧旧版画板”（通过 iframe 调用旧版执行函数）
- 待补充：React 原生逐步执行（当前执行依赖旧版函数）

## 阶段 5
- 已迁移“控制层”：React 可直接触发读取画板命令、执行/逐步执行、导图、导出 TikZ、元素查看
- 当前实现通过 iframe 桥接旧版函数，稳定复用既有逻辑
- 下一阶段目标：逐步替换桥接调用，改为 React 原生 GGB 交互与导出

## 阶段 5.1（已完成）
- 右侧已接入原生 GeoGebra 画板（不再依赖 iframe 才能绘图）
- “执行命令、清空画板”优先走原生 API（不可用时回退旧版桥接）
- 其余高级功能（读取命令、TikZ 导出、元素查看）暂仍桥接旧版

## 阶段 5.2（已完成）
- 修复原生画板“已就绪频闪”问题（初始化回调稳定化）
- “读取命令”优先走原生 `getXML + command 提取`
- “导出图片”优先走原生 `getPNGBase64`
- “导出 TikZ”优先走原生 `GGBParser + TikZGenerator`，失败自动回退旧版桥接

## 启动命令
```bash
cd react-app
npm install
npm run dev
```

## 说明
旧版仍保留在项目根目录 `index.html`，React 迁移失败时可随时回退。
